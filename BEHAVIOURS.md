# Behaviours — Документация

## Обзор

Behaviours (поведения) — это обнаруженные системой паттерны поведения в транскриптах аудио/видео записей. Они представляют собой ключевые моменты разговора, которые система анализирует и выделяет для пользователя.

## Структура данных

### Clip (Клип транскрипта)

Каждый клип транскрипта может содержать один или несколько behaviours.

**Ключевые элементы:**

- `.behaviour` — элемент, содержащий название обнаруженного поведения
- Класс `.evidence` на клипе указывает, что клип содержит обнаруженное поведение
- `data-seek-time` — время начала клипа для навигации и воспроизведения

## Отображение behaviours

### 1. В транскрипте (Transcript Container)

Behaviours отображаются внутри `.clip-caption` каждого клипа транскрипта.

### 2. В таблице сводки (Summary Table)

В таблице сводки behaviours отображаются как кликабельные ссылки в колонке "Detected behaviours, confidence". Используется класс `.detected-behaviour`.

### 3. В визуализации плеера (Player Visualization)

Behaviours отображаются как метки на временной шкале плеера. Используется класс `.behaviour-label`.

**Атрибуты:**

- `data-speaker-index` — индекс спикера (1, 2, 3...)
- `data-position` — позиция на временной шкале в процентах

### 4. В статической визуализации отпечатка (Fingerprint Visualization)

Аналогично визуализации плеера, behaviours отображаются как метки на статической временной шкале. В отличие от плеера, ссылки в статической визуализации не интерактивны.

## JavaScript функциональность

### 1. Навигация между behaviours

Модуль `behavior-navigation.js` обеспечивает навигацию между клипами с behaviours.

**Функция:** `initBehaviorNavigation`

**Функциональность:**

- Находит все клипы с behaviours в хронологическом порядке
- Отслеживает текущую позицию воспроизведения
- Обновляет состояние кнопок "Next" и "Previous"
- При клике переходит к соответствующему клипу, прокручивает страницу и запускает воспроизведение

**Вспомогательная функция:** `findAllBehaviorClips` — находит все клипы с behaviours и сортирует их по времени начала.

### 2. Обработка кликов по behaviours

Модуль `behavior-links.js` обрабатывает клики по ссылкам behaviours.

**Функция:** `initBehaviorLinkHandlers`

**Обрабатываемые элементы:**

- `.detected-behaviour` — ссылки в таблице сводки
- `.behaviour-label a` — ссылки в метках на временной шкале

**Действия при клике:**

1. Находит первый клип с соответствующим поведением
2. Прокручивает страницу к клипу
3. Перематывает аудио к началу клипа
4. Запускает воспроизведение (если не играет)

### 3. Позиционирование меток behaviours

Модули `player-visualization.js` и `fingerprint-visualization.js` позиционируют метки behaviours на временной шкале.

**Функции:**

- `initPlayerVisualization` — позиционирует метки в плеере
- `initFingerprintVisualization` — позиционирует метки в статической визуализации

## Утилиты

### Поиск клипов с behaviours

**Функция:** `findFirstClipWithBehavior` — находит первый клип с указанным поведением.

## Интеграция с другими компонентами

### Связь с клипами транскрипта

- Клипы с behaviours имеют класс `.evidence`
- Элемент `.behaviour` находится внутри `.clip-caption`
- Время начала клипа хранится в `data-seek-time` или `data-time` элемента `.time`

### Связь с визуализацией

- Метки behaviours позиционируются относительно временной шкалы
- Позиция определяется атрибутом `data-position` (в процентах)
- Метки привязаны к конкретному спикеру через `data-speaker-index`

### Связь с навигацией

- Навигация работает только с клипами, имеющими класс `.evidence`
- Клипы сортируются по времени начала (`data-time` или `data-seek-time`)
- Текущая позиция отслеживается на основе времени воспроизведения

## Зависимости

Behaviours зависят от следующих модулей:

- `utils.js` — утилиты для работы с клипами и временем
- `player-visualization.js` — позиционирование меток в плеере
- `fingerprint-visualization.js` — позиционирование меток в статической визуализации
- `behavior-navigation.js` — навигация между behaviours
- `behavior-links.js` — обработка кликов по behaviours
